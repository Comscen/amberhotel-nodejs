<!DOCTYPE html>
<html>

<%- include("../partials/header.ejs") %>

<body>

    <%- include("../partials/nav.ejs") %>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome5-overrides.min.css">

    <div class="container" style="margin-top: 40px">
        
        <div class="row">
            <div class="col">
                <% if (typeof errors != 'undefined') { %>
                    <% for (error of errors) { %>
                        <div class="alert alert-danger" role="alert" style="margin-top: 16px;"><span><%= error.msg %></span></div>
                    <% } %>
                <% } %>

                <% if (typeof messages != 'undefined') { %>
                    <% for (message of messages) { %>
                        <div class="alert alert-success" role="alert" style="margin-top: 16px;"><span><%= message.msg %></span></div>
                    <% } %>
                <% } %>
            </div>
        </div>
        
        <% if (typeof room != 'undefined') { %>
            <div class="row">
                <div class="col-md-6" style="margin-top: 10px;padding: 5px;">
                    <div class="row justify-content-center">
                        <div class="col-md-6 text-center">
                            <% if (typeof room.hotel.photo != 'undefined') { %>
                                <img class="rounded-circle" src="<%= room.hotel.photo %>" width="50px" height="50px">
                            <% } else { %>
                                <img class="rounded-circle" src="/img/no_picture.png" width="50px" height="50px">
                            <% } %>
                        </div>
                    </div>
                    <div class="row justify-content-center" style="margin-top: 6px;">
                        <div class="col-md-12 text-center">
                            <h3>
                                <%= room.hotel.name %>
                                <span class="badge badge-primary" style="background: rgb(224,116,37);font-size: 15px;">3.5<img src="/img/star.png" width="25px" style="margin-top: -5px;width: 15px;"></span>
                            </h3>
                        </div>
                    </div>
                    <hr>
                    <h4 class="text-center"><%= room.name %></h4>
                    <table class="table">
                        <tr>
                            <td><i class="icon ion-android-pin"></i></td>
                            <td><p>Address</p></td>
                            <td><b><%= room.hotel.address %>, <%= room.hotel.postalCode %> <%= room.hotel.city %>, <%= room.hotel.country %></b></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-bed"></i></td>
                            <td><p>Number of beds</p></td>
                            <td><b><%= room.beds %></b></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-user"></i></td>
                            <td><p>Maximum number of people</p></td>
                            <td><b><%= room.capacity %></b></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-star"></i></td>
                            <td><p>Standard</td>
                            <td><b><%= room.standard %></b></p></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-clock"></i></td>
                            <td><p>Check in before</p></td>
                            <td><b><%= room.checkInOut.checkIn %></b></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-clock"></i></td>
                            <td><p>Check out after</p></td>
                            <td><b><%= room.checkInOut.checkOut %></b></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-money-bill-wave"></i></td>
                            <td><p>Price per night</p></td>
                            <td><b>€<%= room.price %></b></td>
                        </tr>
                        <tr style="color:rgb(224,116,37);font-size: 1.3em;">
                            <td><i class="fas fa-money-bill-wave"></i></td>
                            <td><p>Total price</p></td>
                            <td id="totalPrice"><b>€0</b></td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-6 account-info" style="margin: 0px;margin-top: 10px;padding: 20px;">
                    <h4 class="text-center">Personal information</h4>
                    <form method="POST" style="margin-top:15px">
                        <div class="form-group">
                            <div class="form-row">
                                <div class="col">
                                    <%
                                        let currentDate = new Date();
                                        let currentDay = currentDate.getDate() < 10 ? '0' + currentDate.getDate() : currentDate.getDate()
                                        let minStartDateString = `${currentDate.getFullYear()}-${currentDate.getMonth() + 1}-${currentDay}`
                                        let maxStartDateString = `${currentDate.getFullYear() + 1}-${currentDate.getMonth()}-${currentDay}`

                                        let maxDay = (currentDate.getDate() + 1) < 10 ? '0' + (currentDate.getDate() + 1) : (currentDate.getDate() + 1)
                                        let minEndDateString = `${currentDate.getFullYear()}-${currentDate.getMonth() + 1}-${maxDay}`
                                        let maxEndDateString = `${currentDate.getFullYear() + 1}-${currentDate.getMonth()}-${maxDay}`
                                    %>
                                    <label for="reservationBegin">Start date</label>
                                    <input class="form-control" onchange="calculateCost()" name="reservationBegin" id="reservationBegin" type="date" min="<%= minStartDateString %>" max="<%= maxStartDateString %>" required>
                                </div>
                                <div class="col">
                                    <label for="reservationEnd">End date</label>
                                    <input class="form-control" onchange="calculateCost()" name="reservationEnd"  id="reservationEnd" type="date" min="<%= minEndDateString %>" max="<%= maxEndDateString %>" required>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="credentials">Name and surname of card's owner</label>
                            <input class="form-control" type="text" name="credentials" id="credentials" minlength="5" maxlength="64" placeholder="Name and surname of card's owner" required>
                        </div>
                        <div class="form-group">
                            <label for="creditcard">Credit card number</label>
                            <input class="form-control" type="number" name="creditcard" id="creditcard" placeholder="Credit card number" required>
                        </div>
                        <div class="form-group">
                            <div class="form-row">
                                <div class="col">
                                    <label for="cvc">CVC/CVV</label>
                                    <input class="form-control" name="cvc" type="number" max="999" id="cvc" placeholder="CVC/CVV" required>
                                </div>
                                <div class="col">
                                    <label for="expirationDate">Card's expiration date</label>
                                    <input class="form-control" name="expirationDate" id="expirationDate" type="month" required>
                                </div>
                            </div>
                        </div>
                        <div class="form-group text-center align-content-center">
                            <input type="submit" class="btn text-center" style="background: rgb(224,116,37);color:white" value="Submit!"></input>
                        </div>
                    </form>
                    
                </div>
            </div>
        <% } %>

    </div>

    <script type="application/javascript">
        function calculateCost() {
            let startDateArray = document.getElementById('reservationBegin').value.split('-');
            let endDateArray = document.getElementById('reservationEnd').value.split('-');
            if (startDateArray.length != 0 && endDateArray != 0 ) {
                let startDate = new Date(startDateArray[0], startDateArray[1] - 1, startDateArray[2]);
                let endDate = new Date(endDateArray[0], endDateArray[1] - 1, endDateArray[2]);
                
                let price = parseInt('<%= room.price %>');
                let totalCost = 0;
                while (startDate < endDate) {
                    totalCost += price;
                    startDate.setDate(startDate.getDate() + 1);
                }
                return document.getElementById('totalPrice').innerHTML = `<b>€${totalCost}</b>`;
            }
        }
    </script>
    
    <%- include("../partials/footer.ejs") %>
    <%- include("../partials/scripts.ejs") %>

</body>

</html>